#!/usr/bin/env fish

set password_store $HOME/.password-store

# make sure the password store exists
if not test -d $password_store
  printf "Configure \$password_store within "(which dmenu-pass-autotype)".\n" > /dev/stderr
  printf "Its default location, $password_store, does not exist.\n" > /dev/stderr
  exit 1
end

# discern a list of possibilities
set candidates (find "$password_store" -name '*gpg' -print0 |
  tr "\0" "\n" | 
  sed "s#$password_store/##;s#\.gpg\$##")

# ask which
set choice (printf "$candidates" | sort | dmenu -p 'autotype' | chomp)

# notify which we found, using stderr so it isn't piped to anything else
printf "Using $choice.\n" > /dev/stderr

# delegate to pass 
exec pass-autotype "$choice" $argv
