#!/usr/bin/env zsh

sync_email() {
  "$(which -a mbsync | tail -n 1)" $* && notmuch new
}

get_unread_emails() {
  unread_emails="$(find ~/.mail -mindepth 4 -maxdepth 4 |
    grep "/Inbox/new/" |
    wc -l)"
}

notify() {
  get_unread_emails
  if [[ "$unread_emails" -eq 1 ]]; then
    notify-send "You have a new email."
  elif [[ "$unread_emails" -gt 1 ]]; then
    notify-send "You have $unread_emails unread emails."
  fi
}

sync_email $*
notify
