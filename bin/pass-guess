#!/usr/bin/env zsh
set -ue

# make sure the password store exists

  password_store="$HOME/.password-store"

  if [[ ! -d "$password_store" ]]; then
    printf "Configure \$password_store within $(command -v pass-guess).\n" 1>&2
    printf "Its default location, $password_store, does not exist.\n" 1>&2

    exit 3
  fi

# discern a list of possibilities and use fuzzyfind to guess

  guess=$(find "$password_store" -name '*gpg' -print0 |
    tr "\0" "\n" | 
    sed "s#$password_store/##" |
    sed 's#\.gpg$##' |
    fuzzyfind "$1")

# notify which we found, using stderr so it isn't piped to anything else

  printf "Using $guess.\n" 1>&2

# delegate to pass 

  shift # remove the query from the arguments list

  pass show "$guess" $*
